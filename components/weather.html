<div id="weather-box-window" class="box-window">
    <div class="box-window-top">
        <div class="box-window-top-draggable">
            <h3>eXo-weather</h3>
        </div>
        <span class="exit">&times;</span>
        <span class="box-window-toggle-fullScreen">&#9634;</span>
    </div>
    <div>
        <input id="locationInput" type="text" placeholder="enter location" value="" />
    </div>
    <div class="box-window-content">
        <ul id="locationList" style="display: none">
        </ul>
        <div id="weatherData" style="display: none">
            <table>
                <thead>
                    <tr>
                        <th colspan='4'>Forecast</th>
                    </tr>
                    <tr>
                        <th>Date</th>
                        <th>low. temp</th>
                        <th>hig. temp</th>
                        <th>weather</th>
                    </tr>
                </thead>
                <tbody id="tbody_forecast">
                </tbody>
            </table>
            <canvas style="height: 50vh; width: 100%" id="chart_analyze"></canvas>
        </div>
    </div>
    <script>
        $(document).ready(() => {
            var weatherObj = null;
            const getWeatherData = location => {
                try {
                    $('#weatherData').hide();
                    $("#locationList").html("");
                    weather.find({ search: String(location), degreeType: 'C' }, (err, result) => {
                        if (err) {
                            console.log(err, result);
                            return;
                        }
                        weatherObj = result || [];
                        for (var key in weatherObj)
                            if (result.hasOwnProperty(key))
                                $("#locationList").append(`
                                    <li id="${key}_place">
                                        <span class="locSpan">
                                            ${result[key].location.name}
                                        </span>
                                    </li>
                                `);
                        $("#locationList").delay(100).fadeIn(200);
                        $("#locationList").focus();
                    });
                } catch (err) {
                    ipcRenderer.send('request-failed-to-generate-action');
                }
            }

            $('#locationList').on("click", event => {
                let for_dislay = String(event.target.id);
                for_dislay = for_dislay.substr(0, for_dislay.indexOf('_'));
                $("#locationList").fadeOut(200);
                $('#weatherData').delay(100).fadeIn(100);
                $("#tbody_forecast").html("");
                weatherObj[Number(for_dislay)].forecast.forEach(day =>
                    $("#tbody_forecast").append(`
                        <tr>
                            <td>${day.date}</td>
                            <td>${day.low}°C</td>
                            <td>${day.high}°C</td>
                            <td>${day.skytextday}</td>
                        </tr>
                    `)
                );

                var myChart = new Chart(
                    document.getElementById('chart_analyze').getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                        datasets: [{
                            label: '# of Votes',
                            data: [12, 19, 3, 5, 2, 3],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.2)',
                                'rgba(54, 162, 235, 0.2)',
                                'rgba(255, 206, 86, 0.2)',
                                'rgba(75, 192, 192, 0.2)',
                                'rgba(153, 102, 255, 0.2)',
                                'rgba(255, 159, 64, 0.2)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            yAxes: [{
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        }
                    }
                });
            });

            $("#locationInput").on('keypress', event => (event.keyCode == 13) ?
                getWeatherData($("#locationInput").val()) : null
            );
        });
    </script>
</div>