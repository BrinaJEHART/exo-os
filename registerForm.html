<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="regStyle.css">
    <meta charset="UTF-8">
    <title>Register</title>
    <script>
      window.$ = window.jQuery = require("jquery");
    </script>
    <script src="hash.js"></script>
    <script>
    const { ipcRenderer } = require('electron');
    const sqlite3 = require('sqlite3');
      $( document ).ready(function() {
        $.get('util/formback.png')
        .done(function() { 
          $( "body" ).css("background-image", "url('util/formback.png')");
        }).fail(function() { 
          $( "body" ).css("background-color", "#5f5f5f");
        });
        $("#minimize").click(function(){
          ipcRenderer.send('request-register-minimize');
        });
        $("#exit").click(function(){
          window.close();
        });
        function CreateAccount(){
          let already = false;
          if($("#usernameId").val().toString().length && $("#passwordId").val().toString().length){
            try{
              let db = new sqlite3.Database('database.db');
              db.get('SELECT name FROM users WHERE name = "' + $("#usernameId").val() + '"', [], (err, row) =>{
                if(!row){
                  alert("new acc");
                  db.run(`INSERT INTO users (name, pass, date_c)
                  VALUES ("`+$("#usernameId").val()+`", "`+$("#passwordId").val()+`", "`+ new Date().toJSON().slice(0,10).replace(/-/g,'/')+`")`);
                } 
              });
              db.close();
            }catch(e){
              alert(e.toString());
            }
          }else{
            alert("input data");
          }
        }
        $( "#registerButton" ).click(function() {
          CreateAccount();
        });
        $( "#reEnterPasw" ).keypress(function(e) {
          if(e.keyCode == 13)
            CreateAccount();
        });
      });
    </script>
  </head>
  <body>
    <div id="topdiv"> 
      <div style="-webkit-app-region: drag;" class="col"></div>
      <div style="-webkit-app-region: drag;"class="col"></div>
      <div style="-webkit-app-region: drag;"class="col"></div>
      <div style="-webkit-app-region: drag;"class="col"></div>
      <div class="col">
        <button id="minimize"></button>
        <button id="exit"></button>
      </div>
    </div>
    <div align="middle" class="divTable">
      <div class="divTableBody">
          <div class="divTableRow"></div>
        <div class="divTableRow">
          <div class="divTableCell">
            <input id="usernameId" type="name" placeholder="Username">
          </div>
        </div>
        <div class="divTableRow">
          <div class="divTableCell">
            <input id="passwordId" type="password" placeholder="Password">
          </div>
        </div>
        <div class="divTableRow">
          <div class="divTableCell">
            <input id="reEnterPasw" type="password" placeholder="Re-enter password">
          </div>
        </div>
        <div class="divTableRow">
          <div class="divTableCell">
            <button id="registerButton"><b>Register</b></button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
