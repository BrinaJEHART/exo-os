<html>
    <head>
        <title>eXo</title>
        <script>
                window.$ = window.jQuery = require("jquery");
        </script>
        <script >
            $( document ).ready(function(){
                const fs = require("fs");
                $.get("util/iconSearch.png")
                .fail(function() { 
                    $("#icon").hide();
                    $("#searchElement").show();
                });
                let onlineTimer = 0;
                clock();
                changeOnline();
                setTimeout(function() {
                    $(".fly-in-text").removeClass("hidden");
                }, 1000);
                setTimeout(function(){
                    $("#userInfoDiv").hide();
                    $("#getGamesDiv").hide();
                    $("#yourGamesDiv").hide();
                    $("#borderDiv").fadeIn();
                    $("#searchBar").fadeIn();
                    $("#leftFixDIV").fadeIn();
                    $(".fly-in-text").fadeOut();
                    $("#leftBottomFixDIV").fadeIn();
                    $("#informationDiv").fadeIn();
                    $("#windowTitle").text("News Fed");
                    $("#borderDiv").css("background-color", "rgba(77, 254, 133, 0.151)");
                },3000);
                setInterval(changeOnline,60000);
                setInterval(clock, 5000);
                function clock() {
                    let time = new Date();
                    $("#worldClock").html("<b>" + timeFix(time.getHours()) + ":" + timeFix(time.getMinutes()) + "</b>");

                    function timeFix(letx) {
                        if (letx < 10)
                                letx = '0' + letx;
                        return letx;
                    }
                }
                function changeOnline(){
                    onlineTimer++;
                    $("#onlineTime").html("<b>" + onlineTimer + "</b>")          
                }
                //$("#informationDiv").load("home.html");
                const { ipcRenderer } = require('electron');
                /*
                $.get('users/'+ historyData[historyData.length-2] + 'account.txt')
                .done(function(){
                    try{
                        $("#DivUserNAME").html(historyData[historyData.length-2]);
                        let x = historyData.length-4;
                        let theLastLogOn = "";
                        while(true){
                            if(historyData[x] == historyData[historyData.length-2]){
                                theLastLogOn = yyyymmdd( new Date(historyData[x+1]));
                                break;
                            }else if(x <= 0){
                                theLastLogOn = "First time on!"
                                break;
                            }
                            x-=2;
                        }
                        function yyyymmdd(dateIn) {
                            let hours = dateIn.getHours(), minutes = dateIn.getMinutes();
                            if(parseInt(hours )<10){
                                hours = ("0"+dateIn.getHours()).toString();
                            }
                            if(parseInt(minutes)<10){
                                minutes = ("0"+dateIn.getMinutes()).toString();
                            }
                            return (String(dateIn.getMonth()+1+"/"+dateIn.getDate()+"/"+dateIn.getFullYear()+ " ( "+ hours +":" + minutes + " ) "));
                        }
                        function getDateDif(newDate, oldDate){
                            return String(Math.floor(Math.abs(new Date(newDate).getTime() - new Date(userData[2]).getTime())  / (1000 * 3600 * 24)));
                        }

                        $("#DivUserSINCE").html(yyyymmdd( new Date(userData[2])));
                        $("#DivUserLAST").html(theLastLogOn);
                        $("#DivUserGAME").html((userData.length-3).toString());

                        let currentDate = new Date();
                        $("#DivUserAGE").html(getDateDif(currentDate, userData[2]));

                    }catch(e){
                        ipcRenderer.send('request-failed-to-generate-action');
                    }
                }).fail(function(){
                    ipcRenderer.send('request-failed-to-generate-action');
                });*/
                $( "#exit" ).click(function(){
                    window.close();
                });
                $( "#minimize" ).click(function(){
                    ipcRenderer.send('request-mainwindow-minimize');
                });
                $( "#logOut" ).click(function(){
                    ipcRenderer.send('request-mainwindow-logOut');
                });
                $( "#icon" ).mousedown(function(){
                    //search 
                });
                $(function(){
                    $( "#searchBar" ).hover(function(){
                        $(this).find("#searchElement").fadeToggle();
                    });
                });
                $("#userName").mousedown(function(e) {
                    if(e.which === 1){
                        $("#windowTitle").text("Account Info");
                        $("#userInfoDiv").fadeIn();
                        $("#borderDiv").css("background-color", "rgba(185, 127, 231, 0.151)");
                        $(".fly-in-text").fadeOut();
                        $("#informationDiv").fadeOut();
                        $("#getGamesDiv").fadeOut();
                        $("#yourGamesDiv").fadeOut();
                    }
                    else if (e.which === 3){
                        $("#windowTitle").text("/");
                        $("#userInfoDiv").fadeOut();
                        $("#informationDiv").fadeOut();
                        $("#getGamesDiv").fadeOut();
                        $("#yourGamesDiv").fadeOut();
                    }
                });
                $("#yourGames").mousedown(function(e) {
                    if(e.which === 1){
                        $("#windowTitle").text("Owned Games");
                        $("#yourGamesDiv").fadeIn();
                        $("#borderDiv").css("background-color", "rgba(79, 92, 214, 0.151)");
                        $(".fly-in-text").fadeOut();
                        $("#informationDiv").fadeOut();
                        $("#getGamesDiv").fadeOut();
                        $("#userInfoDiv").fadeOut();
                    }
                    else if (e.which === 3){
                        $("#windowTitle").text("/");
                            $("#userInfoDiv").fadeOut();
                            $("#informationDiv").fadeOut();
                            $("#getGamesDiv").fadeOut();
                            $("#yourGamesDiv").fadeOut();
                    }
                });
                $("#getGames").mousedown(function(e) {
                    if(e.which === 1){
                        $("#windowTitle").text("Game Store");
                        $("#getGamesDiv").fadeIn();
                        $("#borderDiv").css("background-color", "rgba(89, 255, 254, 0.158)")
                        $(".fly-in-text").fadeOut();
                        $("#informationDiv").fadeOut();
                        $("#yourGamesDiv").fadeOut();
                        $("#userInfoDiv").fadeOut();
                    }
                    else if (e.which === 3){
                        $("#windowTitle").text("/");
                        $("#userInfoDiv").fadeOut();
                        $("#informationDiv").fadeOut();
                        $("#getGamesDiv").fadeOut();
                        $("#yourGamesDiv").fadeOut();
                    }
                });
                $("#information").mousedown(function(e) {
                    if(e.which === 1){
                        $("#windowTitle").text("News Fed");
                        $("#informationDiv").fadeIn();
                        $("#borderDiv").css("background-color", "rgba(77, 254, 133, 0.151)");
                        $(".fly-in-text").fadeOut();
                        $("#getGamesDiv").fadeOut();
                        $("#yourGamesDiv").fadeOut();
                        $("#userInfoDiv").fadeOut();
                    }
                    else if (e.which === 3){
                        $("#windowTitle").text("/");
                        $("#userInfoDiv").fadeOut();
                        $("#informationDiv").fadeOut();
                        $("#getGamesDiv").fadeOut();
                        $("#yourGamesDiv").fadeOut();
                    }
                });
                $( "#firstGame" ).click(function(){
                    ipcRenderer.send('load-game-request');
                });
                // button click sound effect
                $(function() {
                    $(":button").mousedown(function() {
                        let buttonClickSoundEffect = new Audio();
                        buttonClickSoundEffect.src = "util/clickeffect.mp3";
                        buttonClickSoundEffect.play();
                    });
                });
            });
        </script>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" href="mainpStyle.css">
    </head>
    <body align="center"> 
        <div align="middle" id="topdiv"> 
            <div class="col"><button id="userName"><p id="headtext-display">Account</p></button></div>
            <div  class="col"><button id="yourGames"><p id="headtext-display">Owned</p></button></div>
            <div class="col"><button id="getGames"><p id="headtext-display">Store</p></button></div>
            <div class="col"><button id="information"><p id="headtext-display">News</p></button></div>
            <div class="col"></div>
            <div class="col"></div>
            <div class="col"><button id="logOut"><p id="headtext-functions">Log out</p></button></div>
            <div class="col"><button id="minimize"><p id="headtext-functions">Minimize</p></button></div>
            <div class="col"><button id="exit"><p id="headtext-functions">Exit</p></button></div>
        </div>
        <div id="searchBar">
            <img id="icon" src="util/iconSearch.png" width="6%" height="66%">
            <input id="searchElement" type="name">
        </div>
        <div id="leftFixDIV">
            <div class="divTable">
                <div class="divTableBody">
                    <div style="height:11%" class="divTableRowWatch" align="center"><img src="util/avatar.png"> </div>
                    <div style="height:30%" class="divTableRowWatch" align="center">
                        <div id="CurrentUserOnLeftDiv" width="50%" class="divTableCell"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="leftBottomFixDIV">
            <div class="divTable">
                <div class="divTableBody">
                    <br>
                    <div style="height:11%" class="divTableRowWatch" align="center">
                        <div id="clockTitle" width="50%" class="divTableCell">Online for (min):</div>
                    </div>
                    <div style="height:24%" class="divTableRowWatch" align="center">
                        <div id="onlineTime" width="50%" class="divTableCell"></div>
                    </div><br>
                    <div style="height:11%" class="divTableRowWatch" align="center">
                        <div id="clockTitle" width="50%" class="divTableCell">World Time:</div>
                    </div>
                    <div style="height:24%" class="divTableRowWatch" align="center">
                        <div id="worldClock" width="50%" class="divTableCell"></div>
                    </div>
                </div>
            </div>
        </div>
        <ul align="center" style="text-align: center" class="fly-in-text hidden">
            <li>W</li>
            <li>e</li>
            <li>l</li>
            <li>c</li>
            <li>o</li>
            <li>m</li>
            <li>e</li>
            <br>
        </ul>
        <div id="borderDiv">
            <div id="windowTitle"></div>
            <div id="userInfoDiv">
                <div class="divTable">
                    <div class="divTableBody">
                        <br><br><br>
                        <div class="divTableRow" align="left">
                            <div id="userDivName" width="50%" class="divTableCell"><p id="DivBasicDATA">Username:</p></div>
                            <div id="userDivData" width="50%" class="divTableCell"><p id="DivUserNAME">/</p></div>
                        </div><br>
                        <div class="divTableRow" align="left">
                            <div id="userDivName" width="50%" class="divTableCell"><p id="DivBasicDATA">Member since:</p></div>
                            <div id="userDivData" width="50%" class="divTableCell"><p id="DivUserSINCE">/</p></div>
                        </div><br>
                        <div class="divTableRow" align="left">
                            <div id="userDivName" width="50%" class="divTableCell"><p id="DivBasicDATA">Last logged in:</p></div>
                            <div id="userDivData" width="50%" class="divTableCell"><p id="DivUserLAST">/</p></div>
                        </div><br>
                        <div class="divTableRow" align="left">
                            <div id="userDivName" width="50%" class="divTableCell"><p id="DivBasicDATA">Account age (days):</p></div>
                            <div id="userDivData" width="50%" class="divTableCell"><p id="DivUserAGE">/</p></div>
                        </div><br>
                        <div class="divTableRow" align="left">
                            <div id="userDivName" width="50%" class="divTableCell"><p id="DivBasicDATA">Games owned:</p></div>
                            <div id="userDivData" width="50%" class="divTableCell"><p id="DivUserGAME">/</p></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="yourGamesDiv">
                <button style="width: 100%; height: 5%;" id="firstGame">first game</button>
            </div>
            <div id="getGamesDiv">
            </div>
            <div id="informationDiv">
            </div>
        </div>
    </body>
</html>
