<!DOCTYPE html>
<html>
    <head>
        <title>eXo</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" type="text/css" href="./css/mainpStyle.css">
        <script>
            window.$ = window.jQuery = require("jquery");
        </script>
        <script>
            const { ipcRenderer } = require('electron'); 
            const worldClock = () => {
                let time = new Date();
                const timeFix = x => {
                    return parseInt(x) < 10 ?  `0${x}` : x;
                }
                $("#clock").text(`${timeFix(time.getHours())}:${timeFix(time.getMinutes())}`);  
                setTimeout(worldClock, 60000);
            }
            $( document ).ready(() => {
                worldClock();
                $(".roundBtn").click(e => {
                    switch(String(e.target.id)){
                        case "exit":
                            require('./query').resetValues();
                            window.close();
                            break;
                        case "minimize":
                            ipcRenderer.send('request-mainwindow-minimize');
                            break;
                        case "reset":
                            require('./query').resetValues();
                            getUserData();
                            self.location.assign(location);
                            break;
                        case "back":
                            if(!$("#platformDiv").is(":visible"))break;
                            $(".platformWindow").fadeOut(200);                            
                            break;
                        default: 
                            ipcRenderer.send('request-failed-to-generate-action');
                            break;
                    }
                });
                $(".platButtons").click(e => {
                    $(".platformWindow").hide(); 
                    switch(Number(e.target.id[0])){
                        case 4:
                            $( "#notesDiv" ).fadeIn(200);
                            break;
                        case 5:
                            $( "#calculatorDiv" ).fadeIn(200);
                            break;
                        case 6:
                            setTimeout(() => {
                                if(navigator.onLine) $( "#browserDiv" ).fadeIn(500); 
                                else ipcRenderer.send('request-noConnection-error'); 
                            }, 1000);
                            break;
                        default:
                            ipcRenderer.send('request-failed-to-generate-action');
                            break;
                    }
                });
                $( ".dropbtn" ).click(() => {
                    $(".platformWindow").hide(); 
                    $( "#mainDiv" ).children().hide();
                    $( "#platformDiv" ).fadeIn();
                });
                $(".data").click(e => {
                    $( "#mainDiv" ).children().hide();
                    switch(Number(e.target.id[0])){
                        case 1:
                            $( "#accInfoDiv" ).fadeIn();
                            break;
                        case 2: 
                            $( "#tutorialDiv" ).fadeIn();
                            break;
                        case 3:
                            ipcRenderer.send('request-mainwindow-logOut');
                            break;
                        default:
                            ipcRenderer.send('request-failed-to-generate-action');
                            require('./query').resetValues(); 
                            break;
                    }
                });
                $("#buttonsDiv").mouseover(() => {
                    $("#buttonsDiv div input").fadeIn(1000);       
                });
                $("#buttonsDiv").mouseleave(() => {
                    $("#buttonsDiv div input").fadeOut(100);
  
                });
                $("input#save").click(() => {
                    getUserData();
                });
                $("body").keydown(e => {
                    if ($("input[type=text]").is(":focus")) return; 
                    if (e.which == 81) window.close(); //close application on "q" pressed
                    else if (e.which == 82) self.location.assign(location); //restart app on "r" pressed
                });
                setTimeout(() => {
                    $( "body" ).fadeIn(1500);  
                }, 1000);
                var userData;
                function getUserData(){
                    require('./query').resetValues();
                    function callBack(){
                        userData = require('./query').getUser();
                        setTimeout(() => {
                            if(!userData){
                                callBack();
                                console.log("callback");
                            }else{
                                console.log(userData);
                            }
                        }, 300);
                    }
                    callBack();    
                }
            });
        </script>
    </head>
    <body> 
        <div>
            <div class="dropdown">
              <button class="dropbtn">eXo</button>
              <div class="dropdown-content">
                <a id="1acc" class="data">Account</a>
                <a id="2acc" class="data">Tutorial</a>
                <a id="3acc" class="data">Logout</a>
              </div>
            </div>   
            <div id="clock"></div>
            <a class="roundBtn" id="back" custom_title="back"></a>    
            <a class="roundBtn" id="reset" custom_title="restart program"></a> 
            <a class="roundBtn" id="minimize" custom_title="minimize"></a> 
            <a class="roundBtn" id="exit" custom_title="exit"></a>  
        </div>
        <div id="mainDiv" class="bodyDiv">
            <figure id="welcText">
                <h1>Welcome<br>to Exo!</h1>
                <h1>Welcome<br>to Exo!</h1>
                <h1>Welcome<br>to Exo!</h1>
                <h1>Welcome<br>to Exo!</h1>
                <h1>Welcome<br>to Exo!</h1>
                <h1>Welcome<br>to Exo!</h1>
                <h1>Welcome<br>to Exo!</h1>
                <h1>Welcome<br>to Exo!</h1>
            </figure>
            <div id="platformDiv" style="display:none">
                <div id="buttonsDiv">
                    <div><input class="platButtons" type="button" id="4menu" value="notes"></div>
                    <div><input class="platButtons" type="button" id="5menu" value="calculator"></div>
                    <div><input class="platButtons" type="button" id="6menu" value="browser"></div>
                    <div class="platformWindow" id="notesDiv" style="display:none">
                        <table>
                            <tr><td>note1</td></tr>
                            <tr><td>note2</td></tr>
                            <tr><td>note3</td></tr>
                            <tr><td>note4</td></tr>
                        </table>
                    </div>
                    <div class="platformWindow" id="calculatorDiv" style="display:none">
                        <div id="calcMainView">
                        </div>
                    </div>    
                    <div class="platformWindow" id="browserDiv" style="display:none">
                        <webview id="browserContent"  nodeintegration="on" src="https://www.google.com/">
                        </webview>
                    </div>
                </div>
            </div>
            <div id="accInfoDiv" style="display:none">
                <div id="labels">
                    <div>Username:</div><br>
                    <div>Member since:</div><br>
                    <div>Last seen:</div><br>
                    <div>Account age:</div><br>
                    <div><input id="save" type="button" value="Save"></div>
                </div>
                <div id="accData">
                    <div><input type=text value="username"></div><br>
                    <div>1</div><br>
                    <div>2</div><br>
                    <div>3</div>
                </div>
            </div> 
            <div id="tutorialDiv" style="display:none">
                <p>welcome to the tutorial</p>
            </div>
        </div>
    </body>
</html>
